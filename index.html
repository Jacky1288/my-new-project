<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å®æ—¶èµ„è®¯çœ‹æ¿</title>
  <style>
    :root {
      --bg: #0b1220;
      --card: #111a2c;
      --text: #e6edf7;
      --sub: #9fb0cc;
      --accent: #50a2ff;
      --ok: #4ad295;
      --warn: #ffb74d;
      --line: #1f2b44;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      background: radial-gradient(1200px 600px at 20% -10%, #1d2b4a 0%, var(--bg) 60%);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
    }

    .app {
      max-width: 900px;
      margin: 0 auto;
    }

    .header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    h1 {
      margin: 0;
      font-size: 28px;
    }

    .muted {
      color: var(--sub);
      font-size: 14px;
    }

    .toolbar {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    button {
      border: 1px solid var(--line);
      background: #14213a;
      color: var(--text);
      border-radius: 10px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover { border-color: var(--accent); }

    select {
      border: 1px solid var(--line);
      background: #14213a;
      color: var(--text);
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 14px;
    }

    .status {
      margin: 8px 0 14px;
      font-size: 14px;
      color: var(--sub);
    }

    .status .ok { color: var(--ok); }
    .status .warn { color: var(--warn); }

    .news-list {
      display: grid;
      gap: 10px;
    }

    .news-item {
      background: linear-gradient(180deg, #111a2c 0%, #0f1829 100%);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 14px;
    }

    .news-title {
      margin: 0 0 10px;
      font-weight: 600;
      line-height: 1.5;
    }

    .news-title a {
      color: var(--text);
      text-decoration: none;
    }

    .news-title a:hover {
      color: var(--accent);
      text-decoration: underline;
    }

    .meta {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      color: var(--sub);
      font-size: 13px;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div>
        <h1>ğŸ“° å®æ—¶èµ„è®¯çœ‹æ¿</h1>
        <div class="muted">è‡ªåŠ¨åˆ·æ–°ï¼Œé€‚é… Vercel éƒ¨ç½²</div>
      </div>
      <div class="toolbar">
        <label class="muted" for="refresh-interval">åˆ·æ–°é¢‘ç‡</label>
        <select id="refresh-interval">
          <option value="15000">15ç§’</option>
          <option value="30000" selected>30ç§’</option>
          <option value="60000">60ç§’</option>
        </select>
        <button id="refresh-btn">ç«‹å³åˆ·æ–°</button>
      </div>
    </div>

    <div id="status" class="status">æ­£åœ¨åŠ è½½æœ€æ–°èµ„è®¯...</div>
    <div id="news-container" class="news-list"></div>
  </div>

  <script>
    const statusEl = document.getElementById('status');
    const newsContainer = document.getElementById('news-container');
    const refreshBtn = document.getElementById('refresh-btn');
    const intervalSelect = document.getElementById('refresh-interval');

    let timer = null;

    function formatTime(iso) {
      if (!iso) return 'æœªçŸ¥æ—¶é—´';
      const dt = new Date(iso);
      if (Number.isNaN(dt.getTime())) return 'æœªçŸ¥æ—¶é—´';
      return dt.toLocaleString('zh-CN', { hour12: false });
    }

    function setStatus(text, type = 'normal') {
      statusEl.className = `status ${type === 'ok' ? 'ok' : type === 'warn' ? 'warn' : ''}`;
      statusEl.textContent = text;
    }

    function renderNews(items) {
      if (!items || items.length === 0) {
        newsContainer.innerHTML = '<div class="news-item">æš‚æ— å¯å±•ç¤ºçš„èµ„è®¯ã€‚</div>';
        return;
      }

      newsContainer.innerHTML = items.map(item => `
        <article class="news-item">
          <h3 class="news-title"><a href="${item.url}" target="_blank" rel="noopener noreferrer">${item.title}</a></h3>
          <div class="meta">
            <span>æ¥æºï¼š${item.source || 'æœªçŸ¥æ¥æº'}</span>
            <span>å‘å¸ƒæ—¶é—´ï¼š${formatTime(item.publishedAt)}</span>
          </div>
        </article>
      `).join('');
    }

    async function fetchNews() {
      try {
        setStatus('æ­£åœ¨åŒæ­¥æœ€æ–°èµ„è®¯...');
        const response = await fetch('/api/news', { cache: 'no-store' });
        if (!response.ok) {
          throw new Error(`è¯·æ±‚å¤±è´¥ï¼š${response.status}`);
        }

        const data = await response.json();
        renderNews(data.items || []);

        const updatedText = data.updatedAt
          ? `å·²æ›´æ–°ï¼ˆ${formatTime(data.updatedAt)}ï¼‰ï¼Œå…± ${data.items?.length || 0} æ¡`
          : `å·²æ›´æ–°ï¼Œå…± ${data.items?.length || 0} æ¡`;
        setStatus(updatedText, 'ok');
      } catch (error) {
        console.error('è·å–èµ„è®¯å¤±è´¥ï¼š', error);
        setStatus('åˆ·æ–°å¤±è´¥ï¼Œç¨åè‡ªåŠ¨é‡è¯•ã€‚', 'warn');
      }
    }

    function startAutoRefresh() {
      if (timer) clearInterval(timer);
      timer = setInterval(fetchNews, Number(intervalSelect.value));
    }

    refreshBtn.addEventListener('click', fetchNews);
    intervalSelect.addEventListener('change', startAutoRefresh);

    fetchNews();
    startAutoRefresh();
  </script>
</body>
</html>